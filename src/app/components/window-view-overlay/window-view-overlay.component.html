<div class="window-view-overlay">
  <div class="compass-labels">
    <span class="compass-label">S</span>
    <span class="compass-label">W</span>
    <span class="compass-label">N</span>
    <span class="compass-label">E</span>
    <span class="compass-label">S</span>
  </div>
  <!-- full-height start/end lines (absolute in overlay) -->
  <ng-container *ngFor="let plane of windowViewPlanes">
    <ng-container
      *ngIf="
        plane.isMarker &&
        (plane.callsign.endsWith('Start') || plane.callsign.endsWith('End'))
      "
    >
      <div
        class="vertical-line"
        [ngClass]="{
          'balcony-marker': plane.callsign.startsWith('Balcony'),
          'streetside-marker': plane.callsign.startsWith('Streetside')
        }"
        [style.left]="plane.x + '%'"
      ></div>
    </ng-container>
  </ng-container>
  <div class="planes-container">
    <ng-container *ngFor="let plane of windowViewPlanes">
      <div
        class="plane-dot"
        [ngClass]="{
          'balcony-marker':
            plane.isMarker && plane.callsign.startsWith('Balcony'),
          'streetside-marker':
            plane.isMarker && plane.callsign.startsWith('Streetside')
        }"
        [style.left]="plane.x + '%'"
        [style.bottom]="plane.y + '%'"
        [title]="
          plane.isMarker ? '' : plane.callsign + ' (' + plane.altitude + 'm)'
        "
      >
        <!-- real planes -->
        <ng-container *ngIf="!plane.isMarker">
          <!-- use helicopter icon for helicopters -->
          <ng-container *ngIf="plane.isHelicopter">
            <span
              class="copter-plane-icon material-symbols-sharp"
              [attr.aria-label]="plane.callsign + ' helicopter'"
              [style.transformOrigin]="'center center'"
              >toys_fan</span
            >
          </ng-container>
          <!-- fixed-wing planes with chemtrail and icon -->
          <ng-container *ngIf="!plane.isHelicopter">
            <div
              class="icon-wrapper"
              [style.transform]="'perspective(300px) rotateX(60deg)'"
              [style.transformOrigin]="'center center'"
            >
              <div
                class="chemtrail"
                [style.width.px]="plane.trailLength"
                [style.background]="
                  'rgba(255,255,255,' + plane.trailOpacity + ')'
                "
                [style.transform]="
                  'rotateZ(' +
                  ((plane.bearing ?? 0) + (plane.x < 50 ? 45 : 0)) +
                  'deg)'
                "
              ></div>
              <svg
                class="plane-icon {{ plane.iconType }}"
                viewBox="0 0 64 64"
                [attr.aria-label]="
                  plane.callsign + ' at ' + plane.altitude + 'm'
                "
                [style.transform]="
                  'rotateZ(' +
                  ((plane.bearing ?? 0) + (plane.x > 50 ? -90 : -45)) +
                  'deg)'
                "
                [style.transformOrigin]="'center center'"
              >
                <path [attr.d]="plane.iconPath"></path>
              </svg>
            </div>
          </ng-container>
          <span
            class="plane-label"
            [style.color]="plane.x <= 50 ? 'red' : null"
            >{{ plane.callsign }}</span
          >
        </ng-container>
        <!-- cone markers -->
        <ng-container *ngIf="plane.isMarker">
          <!-- midpoint label -->
          <ng-container
            *ngIf="
              !plane.callsign.endsWith('Start') &&
              !plane.callsign.endsWith('End')
            "
          >
            <div class="line-label">{{ plane.callsign }}</div>
          </ng-container>
        </ng-container>
      </div>
    </ng-container>
  </div>
  <!-- Altitude bands across the entire window view -->
  <div class="altitude-bands-overlay full">
    <ng-container *ngFor="let tick of altitudeTicks; let i = index">
      <div
        *ngIf="i < altitudeTicks.length - 1"
        class="altitude-band"
        [style.bottom]="tick.y + '%'"
        [style.height]="altitudeTicks[i + 1].y - tick.y + '%'"
        [ngStyle]="{ background: getAltitudeColor(tick, i) }"
      ></div>
    </ng-container>
  </div>
</div>
