<app-closest-plane-overlay
  [plane]="closestPlane"
  [distanceKm]="closestDistance"
  [operator]="closestOperator"
  [secondsAway]="closestSecondsAway"
  [velocity]="closestVelocity"
  (selectPlane)="followNearestPlane($event)"
  [isSelected]="closestPlane?.icao === highlightedPlaneIcao"
></app-closest-plane-overlay>

<app-location-overlay
  [plane]="closestPlane"
  [street]="locationStreet"
  [district]="locationDistrict"
  (selectPlane)="followNearestPlane($event)"
  [isSelected]="closestPlane?.icao === highlightedPlaneIcao"
></app-location-overlay>

<app-input-overlay
  (resolveAndUpdate)="resolveAndUpdateFromAddress()"
  (excludeDiscountChange)="onExcludeDiscountChange()"
  (useCurrentLocation)="useCurrentLocation()"
  (goToAirport)="goToAirport()"
  (coneVisibilityChange)="toggleConeVisibility($event)"
  (cloudToggleChange)="toggleCloudCover($event)"
  (setHome)="setCurrentAsHome()"
  (goToHome)="goToHome()"
  (toggleDateTimeOverlays)="onToggleDateTimeOverlays()"
  (brightnessToggle)="toggleBrightness()"
  (zoomIn)="onZoomIn()"
  (zoomOut)="onZoomOut()"
  [brightness]="brightness"
  [showViewAxes]="coneVisible"
  [showDateTime]="showDateTime"
  [showCloudCover]="cloudVisible"
  [showAirportLabels]="showAirportLabels"
  (toggleAirportLabels)="onToggleAirportLabels()"
></app-input-overlay>

<!-- Pass the set of active ICAOs to the results overlay -->
<app-results-overlay
  [skyPlaneLog]="resultsOverlayComponent.skyPlaneLog"
  [airportPlaneLog]="resultsOverlayComponent.airportPlaneLog"
  [seenPlaneLog]="resultsOverlayComponent.seenPlaneLog"
  [loadingAirports]="loadingAirports"
  [highlightedPlaneIcao]="highlightedPlaneIcao"
  [activePlaneIcaos]="activePlaneIcaos"
  (centerPlane)="followNearestPlane($event)"
  (centerAirport)="onCenterAirport($event)"
  (hoverPlane)="onHoverOverlayPlane($event)"
  (unhoverPlane)="onUnhoverOverlayPlane($event)"
></app-results-overlay>

<app-temperature
  *ngIf="showDateTime"
  [resultsCollapsed]="resultsOverlayComponent.collapsed"
></app-temperature>
<app-clock *ngIf="showDateTime"></app-clock>

<div id="map"></div>

<app-cone
  *ngIf="map && coneVisible && homeLocationValue"
  [map]="map"
  [lat]="homeLocationValue!.lat"
  [lon]="homeLocationValue!.lon"
  [distanceKm]="radiusKm"
></app-cone>

<!-- Sun angle indicator overlay -->
<div
  class="sun-angle-overlay"
  [class.collapsed]="resultsOverlayComponent.collapsed"
  [title]="
    isNight
      ? moonPhaseName + ' - Moon azimuth: ' + sunAngle.toFixed(1) + '°'
      : 'Sun azimuth: ' + sunAngle.toFixed(1) + '°'
  "
>
  <!-- Sun event info on left (transparent background, white text) -->
  <span class="sun-info">{{ sunEventText }}</span>
  <app-icon
    [icon]="isNight ? moonIcon : 'sunny_snowing'"
    class="sun-angle-icon"
    variant="outlined"
    [style.transform]="'rotate(' + (sunAngle + (isNight ? 90 : -90)) + 'deg)'"
    [ariaLabel]="isNight ? moonPhaseName + ' direction' : 'Sun direction'"
  ></app-icon>
</div>

<!-- Wind direction indicator overlay -->
<div
  class="wind-angle-overlay"
  [class.collapsed]="resultsOverlayComponent.collapsed"
  [title]="
    'Wind: ' +
    windSpeed.toFixed(1) +
    ' m/s from ' +
    getWindFromDirection(windAngle)
  "
>
  <!-- Wind info on left, transparent background and white text -->
  <span class="wind-info">
    {{ windSpeed.toFixed(1) }} m/s {{ getWindFromDirection(windAngle) }}
  </span>
  <app-icon
    [icon]="'stat_' + windStat"
    class="wind-intensity-icon"
    variant="outlined"
    [style.transform]="'rotate(' + windAngle + 'deg)'"
    ariaLabel="Wind intensity level {{ windStat }}"
  ></app-icon>
</div>
